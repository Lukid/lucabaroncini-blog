---
import BaseLayout from "@/layouts/BaseLayout.astro";
import BlogCard from "@/components/BlogCard.astro";
import { getCollection } from "astro:content";
import { TAGS } from "@/lib/constants";
import type { Tag } from "@/lib/constants";

export async function getStaticPaths() {
  const allPosts = await getCollection("blog", ({ data }) => !data.draft);
  return TAGS.map((tag) => ({
    params: { tag },
    props: {
      posts: allPosts
        .filter((post) => post.data.tags.includes(tag))
        .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()),
    },
  }));
}

const { tag } = Astro.params as { tag: Tag };
const { posts } = Astro.props;
---

<BaseLayout title={`Tag: ${tag}`} description={`Tutti gli articoli con tag "${tag}".`}>
  <h1
    class="font-display text-3xl font-black tracking-tight sm:text-4xl"
    style="font-variation-settings: 'opsz' 48, 'WONK' 1;"
  >
    Tag: <span class="text-[var(--color-accent)]">{tag}</span>
  </h1>

  <div class="stagger-children mt-8 space-y-0">
    {
      posts.map((post: any) => (
        <BlogCard
          title={post.data.title}
          description={post.data.description}
          pubDate={post.data.pubDate}
          tags={post.data.tags}
          slug={post.id}
        />
      ))
    }
  </div>

  {posts.length === 0 && (
    <p class="mt-8 text-[var(--color-text-secondary)]">Nessun articolo con questo tag.</p>
  )}

  <a
    href="/blog"
    class="mt-8 inline-block text-xs font-medium uppercase tracking-widest text-[var(--color-accent)] transition-colors hover:text-[var(--color-accent-hover)]"
  >
    &larr; Tutti gli articoli
  </a>
</BaseLayout>
