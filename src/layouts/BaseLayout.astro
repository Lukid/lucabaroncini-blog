---
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { SITE } from "@/lib/constants";

interface Props {
  title: string;
  description: string;
  image?: string;
  type?: "website" | "article";
  pubDate?: Date;
  updatedDate?: Date;
}

const props = Astro.props;
---

<!doctype html>
<html lang={SITE.lang} class="antialiased">
  <head>
    <BaseHead {...props} />
    {/* Prevent dark mode flash */}
    <script is:inline>
      (function () {
        const theme = localStorage.getItem("theme");
        if (theme === "dark" || (!theme && matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
  </head>
  <body class="flex min-h-dvh flex-col font-body">
    <Header />
    <main class="mx-auto w-full max-w-4xl flex-1 px-6 py-12 sm:px-8">
      <slot />
    </main>
    <Footer />

    {/* IntersectionObserver for scroll animations */}
    <script is:inline>
      (function () {
        if (typeof IntersectionObserver === "undefined") return;
        var io = new IntersectionObserver(
          function (entries) {
            entries.forEach(function (e) {
              if (e.isIntersecting) {
                e.target.classList.add("is-visible");
                io.unobserve(e.target);
              }
            });
          },
          { threshold: 0.1 }
        );
        function observe() {
          document.querySelectorAll(".fade-in-observed, .stagger-children").forEach(function (el) {
            if (!el.classList.contains("is-visible")) io.observe(el);
          });
        }
        observe();
        document.addEventListener("astro:after-swap", observe);
      })();
    </script>
  </body>
</html>
