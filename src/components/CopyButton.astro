---

---

<script>
  function setupCopyButtons() {
    document.querySelectorAll(".prose pre").forEach((pre) => {
      if (pre.querySelector(".copy-btn")) return;

      const btn = document.createElement("button");
      btn.className =
        "copy-btn absolute right-2 top-2 border border-border bg-surface px-2 py-1 text-xs text-text-secondary opacity-0 transition-opacity hover:text-text group-hover:opacity-100";
      btn.textContent = "Copia";
      btn.setAttribute("type", "button");

      const wrapper = document.createElement("div");
      wrapper.className = "group relative";
      pre.parentNode?.insertBefore(wrapper, pre);
      wrapper.appendChild(pre);
      wrapper.appendChild(btn);

      btn.addEventListener("click", async () => {
        try {
          const code = pre.querySelector("code")?.textContent ?? pre.textContent ?? "";
          await navigator.clipboard.writeText(code);
          btn.textContent = "Copiato!";
          setTimeout(() => (btn.textContent = "Copia"), 1500);
        } catch {
          btn.textContent = "Errore";
          setTimeout(() => (btn.textContent = "Copia"), 1500);
        }
      });
    });
  }

  setupCopyButtons();
  document.addEventListener("astro:after-swap", setupCopyButtons);
</script>
